<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\..\bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="..\..\bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="..\..\bower_components/paper-radio-group/paper-radio-group.html">

<dom-module id="reportal-wrap-list">
  <template>
    <style>
      :host {
        display: block;
      }
      paper-checkbox{
        display: block;
        @apply(--reportal-wrap-list-checkbox);
      }
      paper-radio-group{
        display: block;
        @apply(--reportal-wrap-list-radio-group);
      }
      paper-radio-group paper-radio-button{
        display: block;
        @apply(--reportal-wrap-list-radio-button);
      }
      #listWrapper{
        display:block;
      }
    </style>
    <span id="listWrapper">
      <content></content>
    </span>
  </template>
  <script>
    (function() {
      Polymer({
        is: 'reportal-wrap-list',
        listeners:{
          'change':'_reflectToOriginal'
        },
        properties: {
          listType: String
        },
        created:function(){
          this.async(
            function(){
              if(this.listType){
                switch(this.listType){
                  case 'checkbox':case 'radio': this._computeCheckboxRadio();break;
                }
              }
            }
          );
        },
        _computeCheckboxRadio:function(){
          if(this.listType == 'radio'){
            var rg=document.createElement('paper-radio-group');
            Polymer.dom(rg).setAttribute('attr-for-selected','target');
          }
          var cbr = Polymer.dom(this).querySelectorAll('input[type="'+this.listType+'"]');
          if(cbr.length>0){
            var c;
            for(var i=0;i<cbr.length;i++){
              switch(this.listType){
                case 'checkbox': c=document.createElement('paper-checkbox');break;
                case 'radio': c=document.createElement('paper-radio-button');break;
              }
              Polymer.dom(c).setAttribute('target',cbr[i].id);
              if(cbr[i].checked){
                Polymer.dom(c).setAttribute('checked','');
                if(rg){
                  Polymer.dom(rg).setAttribute('selected',cbr[i].id);
                }
              }
              Polymer.dom(c).textContent = Polymer.dom(this).querySelector('label[for="'+cbr[i].id+'"]').textContent;
              rg ? Polymer.dom(rg).appendChild(c) : Polymer.dom(this.root).appendChild(c);
            }
            if(rg){Polymer.dom(this.root).appendChild(rg);}
          }
        },
        _reflectToOriginal:function(e){
          console.log('iron-change fired');
          switch(this.listType){
            case 'checkbox': this._reflectToCheckbox(e);break;
            case 'radio': this._reflectToRadio(e);break;
          }
        },
        _reflectToCheckbox:function(e){
          var hostInput = Polymer.dom(this).querySelector('input[id="'+e.target.attributes.target.value+'"]');
          hostInput.checked ? hostInput.checked = false : hostInput.checked = true;
        },
        _reflectToRadio:function(e){
          Polymer.dom(this.$$('paper-radio-group')).setAttribute('selected',e.target.attributes.target.value);
          var hostInput = Polymer.dom(this).querySelector('input[id="'+e.target.attributes.target.value+'"]');
          hostInput.checked = true;
        }

      });
    })();
  </script>
</dom-module>
