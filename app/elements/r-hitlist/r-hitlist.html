<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\..\bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="..\..\bower_components/iron-icons/iron-icons.html">
<link rel="import" href="..\..\bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="..\..\bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="..\..\bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="..\..\bower_components/paper-item/paper-item.html">
<link rel="import" href="..\..\bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="..\..\bower_components/paper-progress/paper-progress.html">
<link rel="import" href="..\..\bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="..\..\bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="..\r-table-behavior/r-table-behavior.html">
<link rel="import" href="..\..\bower_components/iron-page-url/iron-page-url.html">
<link rel="import" href="..\..\bower_components/iron-pages/iron-pages.html">
<link rel="import" href="..\..\bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="..\..\bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="..\..\bower_components/paper-input/paper-textarea.html">
<link rel="import" href="..\..\bower_components/paper-input/paper-input.html">
<link rel="import" href="..\..\bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="..\..\bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="r-hitlist">
  <template strip-whitespace>
    <style>
      :host{
        display:block;
        position:realtive;
      }
      :host >paper-card {
        display:block;
      }
      :host paper-card#setup{
        --paper-card-background-color: var(--default-primary-color);
        --paper-card-header-color: var(--text-primary-color);
        width: calc(100% - 16px);
        margin: 0 auto;
        margin-bottom:16px;
      }
      :host #settings>paper-card{
        --paper-card-header-color: var(--primary-text-color) !important;
        padding-bottom: 24px;
      }
      :host #setup>paper-tabs paper-tab{
        --paper-tab-content: {
          color:var(--text-primary-color);
        }
      }
      :host #settings paper-card div.layout.vertical>*{margin-bottom:16px; min-width:200px;}
      :host #settings paper-card div.layout.vertical{padding: 0 16px 16px 16px}
      :host #setup iron-pages >*{background-color:white; padding:16px;}

      :host div#pagingInfo{padding:0 24px}
      :host #pagingRow{height:56px; color:rgba(0,0,0,0.54); font-size:12px; font-weight:500; }
      :host #pagingRow>*{@apply(--layout-self-center);}
      :host #pagingRow #pagingForward{margin-right:6px; margin-left:4px}
      :host #pagingRow #pagingBackward{margin-right:8px;}


      input[type="checkbox"] + label:after {
        content: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMi4zMDEyODMyOCw4LjY2MzI1NTM5IEw1Ljk2ODk0OTUyLDEyLjI0NTM5ODcgQzYuMzYwNzYxNiwxMi42MjgwNzQ0IDYuOTg3NTAyMTUsMTIuNjI0Mzc3OSA3LjM3NDc3MzAyLDEyLjIzNzEwNyBMMTMuOTA0NzczMiw1LjcwNzEwNjc4IEMxNC4yOTUyOTc1LDUuMzE2NTgyNDkgMTQuMjk1Mjk3NSw0LjY4MzQxNzUxIDEzLjkwNDc3MzIsNC4yOTI4OTMyMiBDMTMuNTE0MjQ4OSwzLjkwMjM2ODkzIDEyLjg4MTA4NCwzLjkwMjM2ODkzIDEyLjQ5MDU1OTcsNC4yOTI4OTMyMiBMNS45NjA1NTk0NiwxMC44MjI4OTM0IEw3LjM2NjM4Mjk2LDEwLjgxNDYwMTggTDMuNjk4NzE2NzIsNy4yMzI0NTg1IEMzLjMwMzYxMzA3LDYuODQ2NTY3OTEgMi42NzA0OTIxNCw2Ljg1NDAzNjU3IDIuMjg0NjAxNTUsNy4yNDkxNDAyMiBDMS44OTg3MTA5Niw3LjY0NDI0Mzg4IDEuOTA2MTc5NjIsOC4yNzczNjQ4IDIuMzAxMjgzMjgsOC42NjMyNTUzOSBMMi4zMDEyODMyOCw4LjY2MzI1NTM5IFoiIGZpbGw9IiNmZmZmZmYiPjwvcGF0aD48L3N2Zz4=) !important;
      }
      .vaadin-grid-sidebar-button:after {
        content: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjMDAwMDAwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gICAgPHBhdGggZD0iTTEwIDE4aDVWNWgtNXYxM3ptLTYgMGg1VjVINHYxM3pNMTYgNXYxM2g1VjVoLTV6Ii8+ICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=) !important;
      }
      .vaadin-grid-sidebar-content::content span:before {
        content: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjMDAwMDAwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPiAgICA8cGF0aCBkPSJNOSAxNi4xN0w0LjgzIDEybC0xLjQyIDEuNDFMOSAxOSAyMSA3bC0xLjQxLTEuNDF6Ii8+PC9zdmc+) !important;
      }
      :host ::content #hWrapper{
        -webkit-flex:inherit !important;
        flex:inherit !important;
      }
      :host ::content div.hitlist-container{
        font-size:inherit !important;
        font-family:inherit !important;
      }
      :host ::content .light-grey .hitlist .yui3-datatable-table {
        border:0 !important;
        -webkit-border-radius:0 !important;
        -moz-border-radius:0 !important;
        border-radius:0 !important;
      }
      :host ::content .light-grey .hitlist thead tr th:first-child{
        -webkit-border-radius: 0 !important;
        -moz-border-radius: 0 !important;
        border-radius: 0 !important;
      }
      :host ::content .light-grey .hitlist th.yui3-datatable-header,
      :host ::content .light-grey div.yui3-datatable-sort-liner{
        font-family: inherit !important;
        font-size: inherit !important;
        font-weight: 600;
      }
      :host ::content .hitlist .yui3-datatable-header,
      :host ::content .hitlist-nav-prev,
      :host ::content .hitlist-nav-next,
      :host ::content .hitlist-nav-page{
        background-color: transparent !important;
        background-image: none !important;
      }
      :host ::content a.hitlist-nav-prev.disabled:active,
      :host ::content a.hitlist-nav-next.disabled:active,
      :host ::content a.hitlist-nav-page.disabled:active,
      :host ::content a.hitlist-nav-prev.disabled:hover,
      :host ::content a.hitlist-nav-next.disabled:hover,
      :host ::content a.hitlist-nav-page.disabled:hover,
      :host ::content .hitlist .yui3-datatable-odd:hover .yui3-datatable-cell,
      :host ::content .hitlist .yui3-datatable-even:hover .yui3-datatable-cell{
        background-color: #EEEEEE !important;
        background-image: none !important;
      }

      :host ::content .hitlist tr th{
        border-top: 0 !important;
        text-shadow: none !important;
      }

      :host ::content .hitlist th,
      :host ::content .hitlist td{
        padding: 16px 24px 16px 24px !important;
        color: inherit !important;
      }

      :host ::content .hitlist th.yui3-datatable-sorted {
        color: rgba(0, 0, 0, 0.87) !important;
        border-left: 0 !important;
        border-right: 0 !important;
        padding: 0 24px 0 24px !important;
      }
      :host ::content .hitlist th.yui3-datatable-sorted,
      :host ::content .hitlist-dropdown-button,
      :host ::content .hitlist-btn,
      :host ::content .hitlist-dropdown-panel,
      :host ::content .hitlist-column-panel{
        background-color: transparent !important;
        background-image: none !important;
      }
      :host ::content .hitlist th.yui3-datatable-sortable-column .yui3-datatable-sort-indicator{ /*neither*/
        padding-left: 8px !important;
        position: relative !important;
        top: 4px !important;
        background-image: none !important;
      }
      :host ::content .hitlist th.yui3-datatable-sorted .yui3-datatable-sort-indicator{ /*descending*/
        content: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiPiAgICAgICAgPHRpdGxlPlNoYXBlPC90aXRsZT4gICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+ICAgIDxkZWZzPjwvZGVmcz4gICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc2tldGNoOnR5cGU9Ik1TUGFnZSI+ICAgICAgICA8cGF0aCBkPSJNNSwzLjggTDUsMTIgTDcsMTIgTDcsMy44IEwxMC41LDcuNCBMMTEuOSw1LjkgTDYsMCBMMCw1LjkgTDEuNCw3LjQgTDUsMy44IFoiIGlkPSJTaGFwZSIgZmlsbC1vcGFjaXR5PSIwLjg3IiBmaWxsPSIjMDAwMDAwIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1Ljk1MDAwMCwgNi4wMDAwMDApIHNjYWxlKDEsIC0xKSB0cmFuc2xhdGUoLTUuOTUwMDAwLCAtNi4wMDAwMDApICI+PC9wYXRoPiAgICA8L2c+PC9zdmc+) !important
      }
      :host ::content .hitlist th.yui3-datatable-sorted.yui3-datatable-sorted-desc .yui3-datatable-sort-indicator{/*ascending*/
        content: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiPiAgICAgICAgPHRpdGxlPlNoYXBlPC90aXRsZT4gICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+ICAgIDxkZWZzPjwvZGVmcz4gICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc2tldGNoOnR5cGU9Ik1TUGFnZSI+ICAgICAgICA8cGF0aCBkPSJNNSwzLjggTDUsMTIgTDcsMTIgTDcsMy44IEwxMC41LDcuNCBMMTEuOSw1LjkgTDYsMCBMMCw1LjkgTDEuNCw3LjQgTDUsMy44IFoiIGlkPSJTaGFwZSIgZmlsbC1vcGFjaXR5PSIwLjg3IiBmaWxsPSIjMDAwMDAwIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj48L3BhdGg+ICAgIDwvZz48L3N2Zz4=) !important;
        top: 3px !important;
      }
      :host ::content .hitlist tr td {
        border-top: 0 !important;
        border-bottom: 1px solid #e3e3e3 !important;
      }
      :host ::content .hitlist td.yui3-datatable-sorted{
        background: #FFFFFF !important;
        border-left: 0 !important;
        border-right: 0 !important;
      }
      :host ::content .hitlist .yui3-datatable-cell{
        font-family: inherit !important;
        font-size:13px !important;
        color: rgba(0, 0, 0, 0.87) !important;
      }
      :host ::content .hitlisttdcell{
        border:0 !important;
      }



      :host ::content .yui3-datatable-table tr {
        height: var(--reportal-hitlist-row-height, 48px);
        /*left: 0;
        top: 0;
        position: absolute;*/
      }


      :host ::content .yui3-datatable-data td {
        border-bottom: 1px solid #e3e3e3;
        opacity: 1;
      }

      /* Row styles */
      .vaadin-grid-row {
        box-sizing: border-box;
        display: block;
      }

      tbody:not(.touch):not(.scrolling) .vaadin-grid-row:hover td {
        background-color: #eeeeee;
      }

      .vaadin-grid-row-selected td {
        background-color: #f5f5f5;
      }

      /* Focus styles */
      :host ::content .yui3-datatable-data>tr:after {
        background-color: var(--default-primary-color, #03A9F4);
        bottom: 0;
        content: "";
        height: 2px;
        left: 0;
        pointer-events: none;
        position: absolute;
        right: 0;
        transition: all 0.16s ease-in-out;
        -webkit-transform: scaleX(0.0);
        transform: scaleX(0.0);
        z-index: 1;
      }

      :host ::content :focus .yui3-datatable-data>tr:after {
        -webkit-transform: scaleX(1.0);
        transform: scaleX(1.0);
      }

      :host ::content :focus .yui3-datatable-data>tr {
        -webkit-animation: v-grid-row-focused 820ms ease-in-out;
        animation: v-grid-row-focused 820ms ease-in-out;
      }

      @-webkit-keyframes vaadin-grid-row-focused {
        50% {
          color: #03A9F4;
        } 100% {
            color: inherit;
          }
      }

      @keyframes vaadin-grid-row-focused {
        50% {
          color: #03A9F4;
        } 100% {
            color: inherit;
          }
      }

      /* Grid cell */
      :host ::content .yui3-datatable-cell {
        -webkit-align-items: center;
        align-items: center;
        background-color: white;
        box-sizing: border-box;
        /*display: -webkit-inline-flex;
        display: inline-flex;*/
        height: inherit;
        overflow: hidden;
        transition: opacity 0.1s ease-in;
      }

      /* Grid header */
      :host ::content .yui3-datatable-columns {
        box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06),
        0 2px 0 rgba(0, 0, 0, 0.075),
        0 3px 0 rgba(0, 0, 0, 0.05),
        0 4px 0 rgba(0, 0, 0, 0.015);
        box-sizing: border-box;
        /*display: block;
        left: 0;
        position: absolute;
        top: 0;
        z-index: 10;
        padding-right: 2px;*/
      }

      :host ::content .yui3-datatable-columns>tr {
        color: rgba(0, 0, 0, 0.54);
        font-size: 12px;
        height: var(--reportal-hitlist-header-row-height, 56px);
      }

      :host ::content .yui3-datatable-header th {
        font-weight: 500;
        text-align: left;
      }


      /* Input styles */
      input[type="checkbox"] {
        position: absolute;
        opacity: 0;
      }

      input[type="checkbox"] + label {
        position: relative;
        left: 0;
        box-sizing: border-box;
        display: block;
        width: 18px;
        height: 18px;
        border: 2px solid #7a7a7a;
        border-radius: 2px;
        cursor: pointer;
        transition: background-color 120ms, border-color 120ms;
      }

      input[type="checkbox"]:focus {
        outline: none;
      }

      input[type="checkbox"] + label:after {
        content: url(img/tick.svg);
        position: absolute;
        top: -1px;
        left: -1px;
        display: block;
        width: 16px;
        height: 17px;
        transition: all 200ms;
        -webkit-transform: scale(0);
        transform: scale(0);
        -webkit-transform-origin: 40% 80%;
        transform-origin: 40% 80%;
      }

      input[type="checkbox"]:checked + label {
        background-color: var(--default-primary-color, #03A9F4);
        border-color: transparent;
      }

      input[type="checkbox"]:checked + label:after {
        -webkit-transform: scale(1);
        transform: scale(1);
      }

      input[type="checkbox"]:indeterminate + label:after {
        content: "â€“";
        font-family: arial;
        font-weight: bold;
        font-size: 14px;
        line-height: 1;
        text-align: center;
        -webkit-transform: scale(1);
        transform: scale(1);
        transition: none;
      }

      /* Activation "splash" */
      input[type="checkbox"] + label:before {
        content: "";
        position: absolute;
        top: -13px;
        left: -13px;
        width: 41px;
        height: 41px;
        border-radius: 50%;
        background-color: #666;
        opacity: 0;
        -webkit-transform: scale(0.8);
        transform: scale(0.8);
        transition: all 180ms cubic-bezier(0.75,.0,0.25,1);
      }

      input[type="checkbox"] + label:active:before {
        transform: scale(1.1);
        opacity: 0.15;
        transition-duration: 80ms;
        transition-property: all;
      }

      input[type="checkbox"]:checked + label:before {
        background-color: var(--default-primary-color, #03A9F4);
      }

      :host #cardsPlaceholder>r-card{
        padding:16px;
        margin: 5px;
      }
      :host #cardsPlaceholder .details_qTitle{
        font-size: 14px;
        font-weight: 600;
        padding-bottom: 8px;
        color: rgba(0,0,0,0.55);
      }
      :host #cardsPlaceholder .details_qText{
        font-size: 12px;
        white-space: normal;
      }
      :host #cardsPlaceholder .details_qText:not(:last-child){
        padding-bottom: 16px;
      }
      :host paper-progress{
        --paper-progress-active-color: var(--accent-color,#e91e63);
      }
      :host #columnApply{
        background: var(--default-primary-color, #03A9F4);
        color: var(--text-primary-color, #FFFFFF);
      }
      :host #hWrapper{display:none}
    </style>
    <iron-ajax id="ajax" url="" handle-as="json" last-response="{{lastResponse}}"
               debounce-duration="300"
               verbose loading="{{loading}}"></iron-ajax>
    <iron-page-url query="{{query}}">
    </iron-page-url>

    <template is="dom-if" if="[[setup]]" id="setupTemplate">
      <iron-localstorage name="_genericHLconfig" value="{{LS}}" on-iron-localstorage-load-empty="initializeDefaultSetup"></iron-localstorage>
      <paper-card heading="Configure your hitlist" class="flex" id="setup">
        <div hidden="[[!errorNoConfig]]" style="padding:0 16px 16px 16px; color: #ffffff ">
          My minions couldn't detect a HitList on the page. They suppose it doesn't exist or it's hidden.
          In the latter case, please, go to its properties and uncheck the "Hidden" checkbox and save. Then come back and we'll configure it together!
        </div>
        <paper-tabs selected="{{LS.topTab}}" hidden="[[errorNoConfig]]">
          <paper-tab>Your config</paper-tab>
          <paper-tab>Advanced setup</paper-tab>
        </paper-tabs>
        <iron-pages hidden="[[errorNoConfig]]" selected="{{LS.topTab}}">
          <div id="output">
            <paper-textarea label="Your freshly-configured hitlist"></paper-textarea>
            <div><em>Feel free to copy this config and paste it in the page designer in place of the existing tag, then save the page. Afterwards you may check "Hidden" for the original Reportal HitList in its general properties. And, yes, you are welcome. </em></div>
          </div>
          <div id="settings" class="layout vertical">
            <paper-card heading="General Settings" elevation="0" class="flex" >
              <div class="layout vertical start" width="300px">
                <paper-input type="number" on-change="reflectToProperties" label="Frozen columns" value="{{frozenColumns}}" prop="frozenColumns" min="-1" max="{{columnProperties.length}}"></paper-input>
                <paper-input type="number" on-change="reflectToProperties" label="Visible rows" value="{{visibleRows}}" prop="visibleRows" min="1"></paper-input>
                <paper-toggle-button on-change="reflectToProperties" checked="{{assisted}}" prop="assisted">Assisted</paper-toggle-button>
              </div>
            </paper-card>
            <paper-card heading="Columns" elevation="0" class="flex">
              <paper-tabs scrollable selected="{{LS.columnTab}}" class="flex" style="margin: auto -32px;">
                <template is="dom-repeat" items="[[columnProperties]]" as="tabColumn">
                  <paper-tab>{{tabColumn.hidingToggleText}}</paper-tab>
                </template>
              </paper-tabs>
              <iron-pages selected="{{LS.columnTab}}">
                <template is="dom-repeat" items="{{columnProperties}}" as="tabContent" index-as="columnIndex">
                  <div class="layout vertical start">
                    <paper-input type="text" on-change="reflectToOriginal" label="Column title" value="{{tabContent.hidingToggleText}}" prop="hidingToggleText" idx="{{columnIndex}}"></paper-input>
                    Column data prerocessor (renderer):
                    <paper-radio-group on-iron-select="reflectToOriginal" selected="{{tabContent.renderer}}" prop="renderer" idx="{{columnIndex}}">
                      <template is="dom-repeat" items="{{renderers}}" as="renderer">
                        <paper-radio-button name="{{renderer.name}}">{{renderer.descr}}</paper-radio-button>
                      </template>
                    </paper-radio-group>
                    <paper-toggle-button on-change="reflectToOriginal" checked="{{tabContent.hidable}}" prop="hidable" idx="{{columnIndex}}">Hidable</paper-toggle-button>
                    <paper-toggle-button on-change="reflectToOriginal" checked="{{tabContent.hidden}}" prop="hidden" idx="{{columnIndex}}">Hidden</paper-toggle-button>
                    <paper-toggle-button on-change="reflectToOriginal" checked="{{tabContent.sortable}}" prop="sortable" idx="{{columnIndex}}"> Sortable </paper-toggle-button>
                  </div>
                </template>
              </iron-pages>

            </paper-card>
          </div>
        </iron-pages>
      </paper-card>
    </template>

    <!--<template is="dom-if" if="[[!setup]]">-->
    <paper-card heading="hitlist" id="hlWrapper">
      <div id="gridControls" class="horizontal end-justified layout">
        <paper-tooltip id="columnToggleTooltip" for="viewToggle" position="bottom">Switch display mode</paper-tooltip>
        <paper-menu-button  horizontal-align="right" vertical-offset="52" id="viewToggle">
          <paper-icon-button icon="chrome-reader-mode" class="dropdown-trigger"></paper-icon-button>
          <paper-material class="dropdown-content">
            <paper-listbox id="viewList" selected-attribute="selected" attr-for-selected="view" selected="{{defaultView}}">
              <template is="dom-repeat" items="[[views]]" as="view">
                <paper-icon-item view="[[view.view]]"><iron-icon icon="[[view.icon]]" item-icon></iron-icon>[[view.label]]</paper-icon-item>
              </template>
            </paper-listbox>
          </paper-material>
        </paper-menu-button>
      </div>
      <!--<paper-menu-button  horizontal-align="right" vertical-offset="52" ignore-select>
          <paper-icon-button id="columnToggle" icon="view-column" class="dropdown-trigger"></paper-icon-button>
          <paper-tooltip id="columnToggleTooltip" for="columnToggle" position="bottom"></paper-tooltip>
          <paper-meterial class="dropdown-content">
            <paper-item on-tap="columnReset" id="columnReset"></paper-item>
            <paper-item on-tap="columnCheckall" id="columnCheckall"></paper-item>
            <paper-listbox id="columnList" selected-attribute="checked" attr-for-selected="value" multi>
              <template is="dom-repeat" items="[[columns]]" as="column">
                <paper-icon-item value$="[[column.value]]"><iron-icon icon="check" item-icon></iron-icon>{{column.name}}</paper-icon-item>
              </template>

            </paper-listbox>
            <paper-button id="columnCancel"></paper-button>
            <paper-button raised id="columnApply"></paper-button>
          </paper-meterial>
        </paper-menu-button>-->

      <!--table>
        <colgroup>
          <template is="dom-repeat" items="{{colattr}}" as="col">
            <col flex="[[col.flex]]" hidable="[[col.hidable]]" hidden="[[col.hidden]]" hiding-toggle-text="[[col.hidingToggleText]]" max-width="[[col.maxWidth]]" min-width="[[col.minWidth]]" name="[[col.name]]" sortable="[[col.sortable]]" sort-direction="[[col.sortDirection]]" width="[[col.width]]">
          </template>
        </colgroup>
      </table-->
      <paper-progress hidden$="[[!loading]]" indeterminate style="width:100%"></paper-progress>
      <template is="dom-if" if="{{tableView}}" id="hitlistTemplate">
        <vaadin-grid id="hitlist" visible-rows="{{visibleRows}}"></vaadin-grid>
        <div class=" horizontal end-justified layout" id="pagingRow">
          <div id="pagingInfo"></div>
          <paper-icon-button icon="chevron-left" id="pagingBackward"></paper-icon-button>
          <paper-icon-button icon="chevron-right" id="pagingForward"></paper-icon-button>
        </div>
      </template>

    <content id="cards" select="template.cards"></content>
    <template is="dom-if" if="{{cardsView}}" id="cardsTemplate">
      <div id="cardsPlaceholder" class="layout horizontal wrap"></div>
    </template>
    </paper-card>
    <!--</template>-->
  </template>
  <script>
    (function() {
      'use strict';
      var GlobalHitlistConfig = {};
      document.addEventListener("DOMContentLoaded", function() {
        Polymer({
          is: 'r-hitlist',
          listeners:{
            'setupTemplate.dom-change':'setupHitlist',
            'viewList.iron-select':'switchViews',
            'hitlistTemplate.dom-change':'renderHitlist',
            'cardsTemplate.dom-change':'renderCards',

            /*'pagingBackward.tap':'_skipPage',
             'pagingForward.tap':'_skipPage(true)',*/
            //'columnList.iron-select':'_selectOriginal',
            //'columnList.iron-deselect':'_deselectOriginal'
          },

          behaviors: [
            Polymer.IronResizableBehavior,
            Polymer.RTableBehavior,
            Polymer.Templatizer
          ],

          properties: {
            /* if setup is passed, a hitlist configurator is going to be launched*/
            setup:{
              type:Boolean,
              value:false
            },
            LS:{
              type:Object
            },
            renderers:{
              type:Array,
              value:[{name:'html',descr:'Renders content as HTML'},{name:'striphtml',descr:'Strips any HTML, leaving only text'}]
            },
            hitlistOriginalConfig:{
              type:Object,
              notify:true,
              //observer:'setupHitlist',
              value:function(){
                // this.async(function(){
                var scripts = document.querySelectorAll('script');
                if(scripts){
                  var i=scripts.length;
                  while(i--){
                    if(scripts[i] && scripts[i].text && scripts[i].text.indexOf('Y.Reportal.HitList,')>-1){
                      var hitlistScript = scripts[i].text;
                      var re = /(Y\.Reportal\.HitList,)\s(.*?)\);/gi;
                      var cfg = JSON.parse(re.exec(hitlistScript)[2]);
                      return cfg;
                    }
                  }
                } else {return {}}
                //});
              }
            },
            columnProperties:{
              type:Array,
              value:[],
              notify:true
            },
            /*setting-up connection to server*/
            dbType:{
              type:String,
              value:'Production' // Production/TestData
            },
            language:{
              type:Number,
              value:'9'
            },
            hitlist:String,
            queryNormalized:{
              type:Object,
              value:{}
            },
            query:{
              type:String,
              observer:'_parseQuery'
            },

            longText:String,
            longTextWidth:{
              type:Number,
              value:250
            },
            loading:{
              type:Boolean,
              value:false,
              notify:true
            },
            previousSort:{
              type:Object
            },
            columns:{
              type:Array,
              notify:true
            },
            checkallLabels:{
              type:Array,
              value:[]
            },
            views:{
              type:Array,
              value: [
                {view:'table',label:'Table',icon:'view-list'},
                {view:'cards',label:'Cards',icon:'view-module'},
                {view:'map',label:'Map',icon:'room'}
              ]
            },
            defaultView:{
              type:String,
              value:'table'
            },
            lastResponse:{type:Object,observer:'parseResponse'},
            hitlistData:{type:Object,value:{},notify:true,observer:'parseData'}
          },
          switchViews:function(e){
            this.views.forEach(function(item){
              this[item.view+'View'] = (item.view===Polymer.dom(e).event.detail.item.view?true:false);
              this.$.hlWrapper.elevation=Polymer.dom(e).event.detail.item.view==='cards'?0:1;
            }.bind(this));
          },
          setupHitlist:function(){
            if(this.setup){
              var cfg=this.hitlistOriginalConfig;
              console.log(cfg);
              if(cfg){
                this.errorNoConfig = false;
                var columns=[];
                for(var c=0;c<cfg.allColumns.length;c++){
                  var col=cfg.allColumns[c];
                  var cObj={hidable:true, name:col.key, hidingToggleText:col.label};
                  if(col.allowHTML)cObj.renderer='html';
                  if(col.hiddenByDefault)cObj.hidden=true;
                  if(col.sortable)cObj.sortable=true;
                  columns.push(cObj)
                }
                this.columnProperties = columns;
                this.generateCode();
              } else {
                this.errorNoConfig = true;
              }
            }
          },
          generateCode:function(){
            var str= '<' + this.localName +' hitlist="'+this.hitlistOriginalConfig.componentId+'"' + ' language="'+this.hitlistOriginalConfig.language+'"' + ' colattr-legacy="'+ this.serializeColumns(this.columnProperties) +'"' + ' frozen-columns="'+ this.frozenColumns + '"';
            if(this.visibleRows){str += ' visible-rows="'+ this.visibleRows + '"';}
            if(this.assisted){str += ' assisted';}
            str+= '></'+ this.localName + '>';
            this.$$('#setup #output paper-textarea').value = str;
          },
          serializeColumns:function(columns){
            if(columns){
              var c=[];
              for(var i=0;i<columns.length;i++){
                var a=[];
                for(var k in columns[i]){
                  switch(typeof columns[i][k]){
                    case 'boolean': a.push(k);break;
                    case 'string':case 'number':a.push(k+':'+columns[i][k]);break;
                  }
                }
                c.push(a.join(';'));
              }
              return c.join('|');
            }
          },
          reflectToOriginal:function(e){
            var el=Polymer.dom(e).path[0];
            console.log(Polymer.dom(e));
            if(el.localName==='paper-input'){
              this.set('columnProperties.'+el.getAttribute('idx')+'.'+el.getAttribute('prop'), el.value);
            }
            if(el.localName==='paper-toggle-button'){
              this.set('columnProperties.'+el.getAttribute('idx')+'.'+el.getAttribute('prop'), el.checked);
            }
            if(el.localName==='paper-radio-group'){
              this.set('columnProperties.'+el.getAttribute('idx')+'.'+el.getAttribute('prop'), Polymer.dom(e).event.detail.item.name);
            }
            this.generateCode();
          },
          reflectToProperties:function(e){
            var el=Polymer.dom(e).path[0];
            if(el.localName==='paper-input'){
              this[el.getAttribute('prop')]=el.value;
            }
            if(el.localName==='paper-toggle-button'){
              this[el.getAttribute('prop')]=el.checked;
            }
            this.generateCode();
          },
          initializeDefaultSetup:function(){
            this.LS = {topTab:0,columnTab:0}
          },
          _parseQuery:function(query){
            if(query && query.length>0){
              var q=query.split('&'), ql= q.length, qn={};
              while(ql--){
                var qp = q[ql].split('=');
                qn[qp[0].toLowerCase()]=qp[1];
              }
            }
            this.queryNormalized = qn;
          },
          requestResponse:function(options){
            if (this.queryNormalized && !this.queryNormalized.pageid && document.querySelector('#CurrentPageID')) {
              this.queryNormalized.pageid=document.querySelector('#CurrentPageID').value;
            }
            var o= this.queryNormalized;
            var _basePath = 'https://reportal.euro.confirmit.com/reportal/Report/'+ o.reportid + '/HitList/' + this.hitlist;
            /*set common params*/
            var params = {PageId: o.pageid, Preview: o.preview, Language:this.language, DbType:this.dbType};
            /*if options are passed, add options*/
            if(options && typeof options === Object){ console.log(options);
              for (var attrname in options) {
                params[attrname] = typeof options[attrname]==='boolean'?(options[attrname]?'1':'0'):options[attrname];
              }
            }
            if (document.querySelector('#PageStateId')) {
              params.pageStateId=document.querySelector('#PageStateId').value;
            }
            var sortingPagingValues = this.sortingPagingValues || {};

            if (options && options.initialLoad === true && this.$$('#cardsPlaceholder')) {
              this.$$('#cardsPlaceholder').innerHTML = '';
            }

            if (sortingPagingValues && sortingPagingValues.pagingValues && !isNaN(sortingPagingValues.pagingValues.pageNumber)) {
              if (options && options.initialLoad === true) {
                sortingPagingValues.pagingValues = null;
              } else {
                sortingPagingValues.pagingValues.pageNumber += sortingPagingValues.pagingValues.pagingForward ? 1 : -1;
              }
            }
            params.sortingPagingValues=JSON.stringify(sortingPagingValues);
            this.$.ajax.url = _basePath;
            this.$.ajax.params = params;
            this.$.ajax.method="GET";
            this.$.ajax.generateRequest();
          },
          parseData:function(){
            console.log(this.hitlistData);
            //this.requestResponse({initialLoad:1});
          },
          parseResponse:function(r){
            console.log(r);
            r.sortingPagingValues.pagingValues.firstStartValue = this._fixJsonDate(r.sortingPagingValues.pagingValues.firstStartValue);
            r.sortingPagingValues.pagingValues.lastStartValue = this._fixJsonDate(r.sortingPagingValues.pagingValues.lastStartValue);
            this.sortingPagingValues=r.sortingPagingValues;
            var sorting = [];
            var sortBy = r.sortingPagingValues.sortingValues.sortBy;
            for(var s in sortBy){
              var column = this.colattr.map(function(col){return col.name}).indexOf(s);
              var direction = sortBy[s]===-1?'desc':'asc';
              sorting.push({column:column,direction:direction});
            }
            this.previousSort=sorting[0]; //store for comparing sorting in _sortChange
            this.set('hitlistData.data', r.data);
            this.set('hitlistData.sorting', sorting);
            this.set('hitlistData.paging', r.sortingPagingValues.pagingValues);
            this.set('hitlistData.disableNextButton', r.sortingPagingValues.disableNextButton);
            this.set('hitlistData.disableNextButton', r.sortingPagingValues.disableNextButton);
            this.set('hitlistData.length',r.sortingPagingValues.totalHits);
            this.set('hitlistData.pageInfo', r.pageInfo);
            this.async(function(){
              if(this.tableView && this.$$('#hitlist')){
                var grid = this.$$('#hitlist');
                grid.items = r.data;
                grid.size=r.data.length;
                if(!this.visibleRows || (this.visibleRows && this.visibleRows>r.data.length)){grid.visibleRows=r.data.length} else if(this.visibleRows){grid.visibleRows=this.visibleRows;}
                grid.scrollToStart();
                /*set|update buttons and page info*/
                this.$$('#pagingForward').disabled=r.sortingPagingValues.disableNextButton?true:false;
                this.$$('#pagingBackward').disabled=r.sortingPagingValues.disablePrevButton?true:false;
                this.$$('#pagingInfo').textContent = r.pageInfo +' of '+ r.sortingPagingValues.totalHits;
                /*sorting applied*/
                grid.sortOrder = sorting;
              }
              if(this.cardsView && this.$$('#cardsPlaceholder')){
                this.renderCards()
              }

            });

          },
          renderHitlist:function(){
            this.async(function(){
              var grid=this.$$('#hitlist');
              if(grid && grid.columns && grid.columns.length===0){
                /*generate columns*/
                var longText=this.longText && this.longText.length>0?this.longText.toString().split(',').map(function(i){return parseInt(i)}):[];//covert longText string to array
                this.colattr.forEach(function(item,index){
                  if(item.renderer && this.renderer.hasOwnProperty(item.renderer)){item.renderer=this.renderer[item.renderer];}//convert renderer string to function from functions list
                  if(this.longText.length>0 && longText.indexOf(index+1)!=-1){item.maxWidth = parseInt(this.longTextWidth);}
                  grid.addColumn(item);
                  grid.header.getCell(0,index).content = item.hidingToggleText; //replace header content with proper title
                }.bind(this));
                this.set('hitlistData.columns',this.colattr);
                grid.frozenColumns = this.frozenColumns;
                /* setup actions on paging Buttons*/
                this.$$('#pagingForward').addEventListener('tap',function(){this._skipPage(true)}.bind(this));
                this.$$('#pagingBackward').addEventListener('tap',function(){this._skipPage(false)}.bind(this));
                grid.addEventListener('sort-order-changed',function(e){return this._sortChange(e)}.bind(this));
              }
            })
          },
          renderCards:function(){
            this.async(function(){
              /*update template cards or whatever*/
              if(this.$$('#cardsPlaceholder')){
                this.$$('#cardsPlaceholder').innerHTML='';
                var template = Polymer.dom(this.$.cards).getDistributedNodes()[0];
                if(template){
                  this.templatize(template);
                  var hlData = JSON.parse(JSON.stringify(this.hitlistData.data));
                  hlData.forEach(function(item){
                    for(var key in item){
                      var val = item[key];
                      var title = this.hitlistData.columns.filter(function(col){return col.name===key});
                      if(val && title && title.length>0){
                        item[key] = {title: title[0].hidingToggleText, content: val}
                      }
                    }
                    var clone = this.stamp({});
                    clone.card = item;
                    Polymer.dom(this.$$('#cardsPlaceholder')).appendChild(clone.root);
                  }.bind(this));
                  this.updateStyles();
                }
              }
            })
          },
          ready:function(){
            if(this.setup){// bypass all for setup
              //this.setupHitlist(this.hitlistOriginalConfig);
            } else {
              /*get first data*/
              this.requestResponse({initialLoad:true});
              /*grid.items = function(params,callback){
               console.log(params);
               if(!this.$.ajax.loading){
               if(!this.lastResponse){this.requestResponse({initialLoad:1})} else if(!this.lastResponse.sortingPagingValues.disableNextButton){
               this._skipPage(true);
               }
               }
               this.$.ajax.removeEventListener('last-response-changed');
               this.$.ajax.addEventListener('last-response-changed',function() {
               console.log('response received');
               console.log(this.lastResponse);
               callback(this.lastResponse.data);
               }.bind(this))

               //console.log(params);

               }.bind(this);*/

              //this.requestResponse();
              /*this.grid.addEventListener('sort-order-changed',function(e){return that._sortChange(e)});
               //return that.debounce('getHitlist',function(){that._retrieveHitList()},50);
               if (typeof YUI !== 'undefined') {
               YUI().use('event-custom', function (Y) {
               Y.Global.on('hitlistloaded', function () {
               return that.debounce('getHitlist',function(){that._retrieveHitList()},100);
               });
               });
               }*/

              /* trim text on long fields and display it in a card on row-click*/
              /*if(this.longText){
               var detailsOpenIndex = -1;
               // Show details for the selected row
               var grid = this.grid;
               grid.addEventListener('selected-items-changed', function() {
               grid.setRowDetailsVisible(detailsOpenIndex, false);
               var selected = grid.selection.selected();
               if (selected.length == 1) {
               grid.setRowDetailsVisible(selected[0], true);
               detailsOpenIndex = selected[0];
               }
               });
               grid.rowDetailsGenerator = function(rowIndex) {
               var elem = document.createElement('paper-material');
               elem.setAttribute('elevation', 4);
               elem.classList.add('detailsPaper');
               var columns = that.longText.split(',');
               grid.getItem(rowIndex, function(error, item) {
               if (!error) {
               var questionRow = document.createElement('div');
               for(var i=0;i<columns.length;i++){
               var questionTitle = document.createElement('div');
               questionTitle.classList.add('details_qTitle');
               questionTitle.textContent = grid.columns[parseInt(columns[i])-1].name;
               var questionText = document.createElement('div');
               questionText.classList.add('details_qText');
               questionText.textContent = item[parseInt(columns[i])-1];
               questionRow.appendChild(questionTitle);
               questionRow.appendChild(questionText);
               }
               elem.innerHTML = questionRow.innerHTML;
               }
               });
               return elem;
               }
               }*/

            }

          },
          _skipPage: function(pagingForward, callback){
            var spv = this.sortingPagingValues.pagingValues;
            spv.pagingForward = pagingForward; /*if forward is needed then pass true, else null - backward*/
            spv.startId = pagingForward ? spv.lastStartId : spv.firstStartId;
            spv.startValue = pagingForward ? spv.lastStartValue : spv.firstStartValue;
            this.requestResponse({isPaging: true}, callback);
          },
          _retrieveHitList:function(){
            if(this.grid.columns.length===0){this._getHitListHeading();}
            this._getHitListData();
            //this._getHitListColumnToggle();
            this.loaded=true;
          },
          _getHitListHeading:function(){
            var heading = this.querySelectorAll('.yui3-datatable-table>.yui3-datatable-columns>tr>th');
            var grid = this.grid;

            if(grid.columns.length>0){grid.columns=[];}
            if(this.longText){
              var lt = this.longText.split(',');
            }
            if(heading && heading.length>0){
              if(this.colattrLegacy && this.colattrLegacy.length>0){
                this._processLegacyAttributes(this.colattrLegacy);
              }

              for(var i=1;i<heading.length;i++){
                var attr={};
                attr.name = heading[i].textContent.trim();
                attr.sortable = heading[i].classList.contains('yui3-datatable-sortable-column')?true:false;
                attr.hidable = true;
                if(lt && lt.indexOf((i).toString())>-1){
                  attr.maxWidth = parseInt(this.longTextWidth);
                }
                var colattr = this.colattr;
                if(colattr[i-1]){
                  for(var ci=0;ci<colattr[i-1].length;ci++){ // populate column properties
                    if(colattr[i-1][ci].length>0){
                      this._a2o(attr,colattr[i-1][ci][0],colattr[i-1][ci][1]);
                    }
                  }
                }
                attr.hidingToggleText = attr.name;
                grid.addColumn(attr);
                if(heading[i].classList.contains('yui3-datatable-sorted')){
                  grid.sortOrder = heading[i].classList.contains('yui3-datatable-sorted-desc')? [{column: i-1, direction: "desc"}]:[{column: i-1, direction: "asc"}];
                }
              }
            }
          },
          _getHitListData:function(){
            var DS = this.querySelectorAll('tbody.yui3-datatable-data>tr');
            var grid = this.grid;
            var items = [];
            if(DS && DS.length>0){
              for(var i=0;i<DS.length;i++){
                var row=[];
                for(var td=1;td<DS[i].children.length;td++){
                  row.push(DS[i].children[td].textContent.trim());
                }
                items.push(row);
              }
              grid.items = items;
              grid.size = items.length;
            }
          },
          /*_getHitListColumnToggle:function(){
           var nativeColumnToggle = this.querySelector('.yui3-datatable-table>thead th:first-child>.hitlist-btn');
           this.$.columnToggleTooltip.textContent=nativeColumnToggle.getAttribute('title');//set tooltip text
           nativeColumnToggle.click();
           var self = this;
           this.poll(function(){return self.querySelector('.hitlist>.hitlist-column-panel')},
           function(){
           var colDD= self.querySelector('.hitlist>.hitlist-column-panel');
           if(colDD){
           //set "Show default columns" dropdown text
           self.$.columnReset.textContent=colDD.querySelector('.hitlist-column-panel-reset').textContent.trim();
           //populate column action buttons
           self.$.columnCancel.textContent = colDD.querySelector('.hitlist-column-panel-cancel').textContent.trim();
           //self.$.columnCancel.addEventListener('tap',function(e){console.log(e.target.domHost.querySelector('.hitlist-column-panel-cancel'))});
           self.$.columnApply.textContent = colDD.querySelector('.hitlist-column-panel-apply').textContent.trim();
           //populate CheckAll button and columns to reflect checkboxes
           var columns = Polymer.dom(colDD).querySelectorAll('.hitlist-column-row');
           var aColumns = [];
           for(var i=0;i<columns.length;i++){
           var o={};
           o.value=columns[i].children[0].value;
           o.name=columns[i].children[1].textContent.trim();
           console.log(o);
           aColumns.push(o);
           }
           self.columns=aColumns;

           self._columnCheckboxes();
           }
           },function(){
           console.error('failed to find column control menu');
           },5000,500);
           },
           columnReset:function(){
           this.querySelector('.yui3-datatable-table>thead th:first-child>.hitlist-btn').click();
           this.async(function(){console.log('click reset');this.querySelector('.hitlist-column-panel-reset').click();});
           this.async(function () {
           console.log('columnReset, calc anew');
           this._columnCheckboxes();
           }, 100);
           },
           columnCheckall:function(){
           console.log(this.checkallLabels);
           if(this.$.columnList.selectedValues.length>0 && this.$.columnList.selectedValues===this.columns.length){
           this.$.columnList.selectedValues=[];
           Polymer.dom(this.$.columnCheckall).textContent = this.checkallLabels[1];
           //this.querySelector('.yui3-datatable-table>thead th:first-child>.hitlist-btn').click();
           } else {
           this.$.columnList.selectedValues=this.columns.map(function(item){return item.value});
           Polymer.dom(this.$.columnCheckall).textContent = this.checkallLabels[0];
           }
           },
           columnCancel:function(){
           this.querySelector('.yui3-datatable-table>thead th:first-child>.hitlist-btn').click();
           this.async(function (){this.querySelector('.hitlist-column-panel-cancel').click()},100);
           //this.querySelector('paper-menu-button').close();
           this.async(function (){this._columnCheckboxes();},150);
           },
           columnApply:function(){
           this.querySelector('.yui3-datatable-table>thead th:first-child>.hitlist-btn').click();
           var checkedItems=this.$.columnList.selectedItems;
           checkedItems=checkedItems.map(function(item){return item.value});
           console.log(checkedItems);
           var cb = this.querySelector('.hitlist>.hitlist-column-panel .hitlist-column-row>input');
           for(var i=0;i<cb.length;i++){
           if(checkedItems.indexOf(cb[i].value)){
           cb[i].checked=true;
           } else {
           cb[i].checked=false
           }
           }
           //this.querySelector('paper-menu-button').close();
           this.querySelector('.hitlist-column-panel-apply').click();
           //this.async(function () {this._columnCheckboxes();}, 50);
           },
           _columnCheckboxes:function(){
           console.log('_columnCheckboxes');
           var colDD= this.querySelector('.hitlist>.hitlist-column-panel');
           //set "Uncheck all" dropdown text
           Polymer.dom(this.$.columnCheckall).textContent=colDD.querySelector('.hitlist-column-panel-checkall').textContent.trim();
           var columns = Polymer.dom(colDD).querySelectorAll('.hitlist-column-row');
           //take care of checked columns array
           this.async(function(){
           console.log('_columnCheckboxes async');
           var checked = columns.filter(function(item){console.log(item.children[0]); return item.children[0].getAttribute('checked')==='checked'});
           console.log(checked);
           var map=checked.map(function(item){return item.children[0].value});
           if(this.checkallLabels.length===0){
           this.checkallLabels.push(colDD.querySelector('.hitlist-column-panel-checkall').textContent.trim());
           colDD.querySelector('.hitlist-column-panel-checkall').click();
           if(checked.length===columns.length){ // applied check all label
           this.async(function(){this.checkallLabels.unshift(colDD.querySelector('.hitlist-column-panel-checkall').textContent.trim())},100);
           } else {
           this.async(function(){this.checkallLabels.push(colDD.querySelector('.hitlist-column-panel-checkall').textContent.trim())},100);
           }
           }
           console.log(this.checkallLabels);
           this.$.columnList.selectedValues= map;
           console.log(map);
           },100);
           },
           _selectOriginal:function(e){
           console.log(e);
           var el = this.querySelector('.hitlist>.hitlist-column-panel input[value="' + e.detail.item.value + '"]');
           console.log('apply check')
           el.setAttribute('checked',true);
           el.checked=true;
           console.log(el);
           },
           _deselectOriginal:function(e){
           console.log(e);
           var el = this.querySelector('.hitlist>.hitlist-column-panel input[value="' + e.detail.item.value + '"]');
           console.log('remove check')
           el.removeAttribute('checked');
           el.checked=false;
           console.log(el);
           },*/
          _sortChange:function(e){
            if(!this.previousSort || (this.previousSort && (this.previousSort.column !== e.detail.value[0].column || this.previousSort.direction !== e.detail.value[0].direction))){
              if (this.loading){return;}
              this.sortingPagingValues.sortingValues.sortBy={};
              this.sortingPagingValues.sortingValues.sortBy[this.colattr[e.detail.value[0].column].name]=e.detail.value[0].direction==='asc'?1:-1;
              console.log(this.sortingPagingValues);
              this._clearPaging();
              this.requestResponse({
                isSorting: true,
                initialLoad: true
              });
            }
          },
          _clearPaging: function() {
            this.sortingPagingValues.pagingValues = null;
          },
          _fixJsonDate: function(jsonDate) {
            if (!(jsonDate && Y.Lang.isFunction(jsonDate.replace))) {return jsonDate;}
            var constructor = jsonDate.replace(new RegExp("^/Date\\(([-+]?\\d+)\\)/$"), "new Date($1)");
            if (constructor == jsonDate) {return jsonDate;}
            return eval(constructor);
          }


        });
      });

    })();
  </script>
</dom-module>
